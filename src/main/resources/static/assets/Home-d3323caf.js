import{D as _,S as x,P as V,p as m,i as C}from"./DeleteDialog-3c0c6c56.js";import b from"./ProductDetail-adf93b8c.js";import{_ as v,r as p,o as u,b as f,a as t,w as o,d as c,F as S,e as w,f as y,g as h,h as z,c as T,i as B,t as d}from"./index-ba8ae7a7.js";import{V as E,a as k}from"./VToolbar-f66d05f2.js";import{V as H,a as D,b as I}from"./VRow-c9acae30.js";import{V as L}from"./VSpacer-9429de5a.js";import{V as N,a as A,b as F,c as R}from"./VCard-a98264cd.js";import"./api-9de8bbcf.js";import"./VDialog-493d3ece.js";const j={name:"Home",components:{DeleteDialog:_,SearchSort:x,ProductSave:V,ProductDetail:b},data(){return{loading:!1,products:[],page:1,pageSize:15,maxPageSize:1,sortBy:"",searchText:"",show:{}}},mounted(){this.fetchProducts(),window.addEventListener("scroll",this.handleScroll)},beforeUnmount(){window.removeEventListener("scroll",this.handleScroll)},methods:{goToAdmin(){this.$router.push("/panel/profile")},showDetail(e){this.show[e.id]=!0,this.show={...this.show}},handleSubmit(){this.page=1,this.maxPageSize=1,this.products=[],this.fetchProducts()},handleSort(e){this.sortBy=e,this.page=1,this.maxPageSize=1,this.products=[],this.fetchProducts()},handleSearch(e){this.searchText=e},deleteProduct(e){m.deleteProduct(e).then(s=>{this.page=1,this.maxPageSize=1,this.products=[],this.fetchProducts()})},saveProduct(e){console.log(e),m.updateProduct(e.id,e).then(s=>{this.page=1,this.maxPageSize=1,this.products=[],this.fetchProducts()})},handleImageError(e){e.target.src="https://dummyimage.com/300x300/000/fff",console.log(e)},handleScroll(){const e=this.$refs.scrollContainer,s=e.scrollTop,n=e.clientHeight,r=e.scrollHeight;s+n-40>=r&&console.log("滚动到底部"),s+n+40>=r&&!this.loading&&this.page<=this.maxPageSize&&this.fetchProducts()},fetchProducts(e){this.loading=!0,m.getProductList({params:{page:this.page-1,size:this.pageSize,sortBy:this.sortBy,name:this.searchText}}).then(s=>{let n=s.data.content;this.products=[...this.products,...n],this.maxPageSize=s.data.totalPages,this.page===this.maxPageSize&&this.$refs.scrollContainer.removeEventListener("scroll",this.handleScroll),this.page+=1,this.loading=!1,this.products.forEach(r=>{this.show[r.id]=!1;let l=JSON.parse(r.description),a=document.createElement("div");a.innerHTML=(l.description!=="null"?l.description:"")+(l.ingredients?l.ingredients:""),r.detail=a.textContent,C.getImageByProductId(r.id).then(g=>{r.image="data:image/jpeg;base64,"+g.data.content})}),this.$refs.scrollContainer.scrollHeight<=this.$refs.scrollContainer.clientHeight&&this.page<=this.maxPageSize&&this.fetchProducts()})}}},J=c("span",{class:"text-uppercase font-weight-bold"},"美食管家",-1),M={style:{color:"red",float:"right"}},O={style:{"font-size":"small"}};function U(e,s,n,r,l,a){const g=p("SearchSort"),P=p("ProductDetail");return u(),f(S,null,[t(E,{color:"primary",dark:""},{default:o(()=>[t(k,null,{default:o(()=>[J]),_:1}),t(L),t(w,{icon:"",onClick:a.goToAdmin},{default:o(()=>[t(y,null,{default:o(()=>[h("mdi-account-details")]),_:1})]),_:1},8,["onClick"])]),_:1}),c("div",null,[t(g,{style:{height:"140px"},loading:l.loading,onSearch:a.handleSearch,onSort:a.handleSort,onSubmit:a.handleSubmit},null,8,["loading","onSearch","onSort","onSubmit"]),c("div",{ref:"scrollContainer",style:{"overflow-y":"auto",height:"calc(100vh - 140px)"},onScroll:s[1]||(s[1]=(...i)=>a.handleScroll&&a.handleScroll(...i))},[t(H,null,{default:o(()=>[t(D,null,{default:o(()=>[(u(!0),f(S,null,z(l.products,i=>(u(),T(I,{key:i.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[t(N,{style:{"padding-bottom":"20px"},onClick:s[0]||(s[0]=()=>{})},{default:o(()=>[t(B,{"aspect-ratio":"1.8",src:i.image,onError:a.handleImageError},null,8,["src","onError"]),t(A,null,{default:o(()=>[h(d(i.name),1),c("span",M,[h("￥"+d(i.price.toString().split(".")[0])+".",1),c("span",O,d(i.price.toString().split(".").length===2?i.price.toString().split(".")[1]:"00"),1)])]),_:2},1024),t(F,null,{default:o(()=>[h(d(i.detail),1)]),_:2},1024),t(R,null,{default:o(()=>[t(P,{product:i,visible:l.show},null,8,["product","visible"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})],544)])],64)}const ee=v(j,[["render",U]]);export{ee as default};
